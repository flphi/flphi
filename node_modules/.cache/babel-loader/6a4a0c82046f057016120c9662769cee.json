{"remainingRequest":"C:\\Users\\Florian\\Desktop\\projet\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\Florian\\Desktop\\projet\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\Florian\\Desktop\\projet\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Florian\\Desktop\\projet\\src\\views\\Users.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Florian\\Desktop\\projet\\src\\views\\Users.vue","mtime":1587691631772},{"path":"C:\\Users\\Florian\\Desktop\\projet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Florian\\Desktop\\projet\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\Florian\\Desktop\\projet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Florian\\Desktop\\projet\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc29tZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzIjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IFJlc3RDbGllbnQgZnJvbSAnLi4vdXRpbHMvcmVzdC1jbGllbnQnOwppbXBvcnQgVXNlckF1dGhlbnRpZmljYXRpb24gZnJvbSAnLi4vdXRpbHMvdXNlci1hdXRoZW50aWZpY2F0aW9uJzsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJVc2VycyIsCiAgcHJvcHM6IFtdLAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICB1c2VyczogW10sCiAgICAgIG5ld0VtYWlsOiAnJywKICAgICAgY3VycmVudFVzZXI6IG51bGwsCiAgICAgIGVkaXRpbmdVc2Vyc0VtYWlsOiB7fQogICAgfTsKICB9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIGlmICghVXNlckF1dGhlbnRpZmljYXRpb24uaXNBdXRoZW50aWNhdGVkKCkpIHsKICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgIHBhdGg6ICcvbG9naW4nCiAgICAgIH0pOwogICAgICByZXR1cm47CiAgICB9CgogICAgdGhpcy5jdXJyZW50VXNlciA9IFVzZXJBdXRoZW50aWZpY2F0aW9uLmdldEN1cnJlbnRVc2VyKCk7CgogICAgaWYgKFVzZXJBdXRoZW50aWZpY2F0aW9uLmlzQ3VycmVudFVzZXJTdXBlclVzZXIoKSkgewogICAgICBSZXN0Q2xpZW50LmdldCgidXNlciIpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIHJldHVybiBfdGhpcy51c2VycyA9IHJlcy5kYXRhLnVzZXJzOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgcmV0dXJuIGNvbnNvbGUubG9nKGVycik7CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy51c2VycyA9IFt0aGlzLmN1cnJlbnRVc2VyXTsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIG9uU3VwZXJVc2VyQ2hhbmdlOiBmdW5jdGlvbiBvblN1cGVyVXNlckNoYW5nZShldmVudCwgdXNlcikgewogICAgICBjb25zb2xlLmxvZyhldmVudCk7CiAgICAgIGNvbnNvbGUubG9nKHVzZXIuc3VwZXJfdXNlcik7CiAgICAgIFJlc3RDbGllbnQucHV0KCJ1c2VyLyIuY29uY2F0KHVzZXIucHVibGljX2lkKSwgewogICAgICAgIHN1cGVyX3VzZXI6IGV2ZW50LnRhcmdldC52YWx1ZSA9PSAidHJ1ZSIKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgY29uc29sZS5sb2cocmVzKTsKICAgICAgICB1c2VyLnN1cGVyX3VzZXIgPSBldmVudC50YXJnZXQudmFsdWUgPT0gInRydWUiOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgcmV0dXJuIGNvbnNvbGUubG9nKGVycik7CiAgICAgIH0pOwogICAgfSwKICAgIG9uTmV3RW1haWxDaGFuZ2U6IGZ1bmN0aW9uIG9uTmV3RW1haWxDaGFuZ2UoJGV2ZW50LCB1c2VyKSB7CiAgICAgIHRoaXMuZWRpdGluZ1VzZXJzRW1haWxbdXNlci5wdWJsaWNfaWRdID0gJGV2ZW50LnRhcmdldC52YWx1ZTsKICAgIH0sCiAgICBvbkVkaXRFbWFpbENsaWNrOiBmdW5jdGlvbiBvbkVkaXRFbWFpbENsaWNrKHVzZXIpIHsKICAgICAgdGhpcy5lZGl0aW5nVXNlcnNFbWFpbFt1c2VyLnB1YmxpY19pZF0gPSB1c2VyLmVtYWlsOwogICAgICB0aGlzLiRmb3JjZVVwZGF0ZSgpOwogICAgfSwKICAgIGRlbFVzZXI6IGZ1bmN0aW9uIGRlbFVzZXIoZXZlbnQsIHVzZXIpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICBpZiAoIVVzZXJBdXRoZW50aWZpY2F0aW9uLmlzQ3VycmVudFVzZXJTdXBlclVzZXIoKSkgewogICAgICAgIGFsZXJ0KCdWb3VzIG5cJ8OqdGVzIHBhcyBzdXBlciB1dGlsaXNhdGV1cicpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgUmVzdENsaWVudC5kZWxldGUoInVzZXIvIi5jb25jYXQodXNlci5wdWJsaWNfaWQpKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczIudXNlcnMgPSBfdGhpczIudXNlcnMuZmlsdGVyKGZ1bmN0aW9uICh1KSB7CiAgICAgICAgICByZXR1cm4gdS5wdWJsaWNfaWQgIT09IHVzZXIucHVibGljX2lkOwogICAgICAgIH0pOwogICAgICAgIGNvbnNvbGUubG9nKHJlcyk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICByZXR1cm4gY29uc29sZS5sb2coZXJyKTsKICAgICAgfSk7CiAgICB9LAogICAgaXNFZGl0aW5nRW1haWw6IGZ1bmN0aW9uIGlzRWRpdGluZ0VtYWlsKHVzZXIpIHsKICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMuZWRpdGluZ1VzZXJzRW1haWwpLnNvbWUoZnVuY3Rpb24gKHB1YmxpY19pZCkgewogICAgICAgIHJldHVybiBwdWJsaWNfaWQgPT09IHVzZXIucHVibGljX2lkOwogICAgICB9KTsKICAgIH0sCiAgICB1cGRhdGVVc2VyRW1haWw6IGZ1bmN0aW9uIHVwZGF0ZVVzZXJFbWFpbCh1c2VyKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgUmVzdENsaWVudC5wdXQoIi91c2VyL2VtYWlsLyIuY29uY2F0KHVzZXIucHVibGljX2lkKSwgewogICAgICAgIG5ld19lbWFpbDogdGhpcy5lZGl0aW5nVXNlcnNFbWFpbFt1c2VyLnB1YmxpY19pZF0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICB1c2VyLmVtYWlsID0gX3RoaXMzLmVkaXRpbmdVc2Vyc0VtYWlsW3VzZXIucHVibGljX2lkXTsKICAgICAgICBkZWxldGUgX3RoaXMzLmVkaXRpbmdVc2Vyc0VtYWlsW3VzZXIucHVibGljX2lkXTsKCiAgICAgICAgX3RoaXMzLiRmb3JjZVVwZGF0ZSgpOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICByZXR1cm4gY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgIH0pOwogICAgfQogIH0KfTs="},{"version":3,"sources":["Users.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA,OAAA,UAAA,MAAA,sBAAA;AACA,OAAA,oBAAA,MAAA,gCAAA;AAEA,eAAA;AACA,EAAA,IAAA,EAAA,OADA;AAEA,EAAA,KAAA,EAAA,EAFA;AAGA,EAAA,IAAA,EAAA,gBAAA;AACA,WAAA;AACA,MAAA,KAAA,EAAA,EADA;AAEA,MAAA,QAAA,EAAA,EAFA;AAGA,MAAA,WAAA,EAAA,IAHA;AAIA,MAAA,iBAAA,EAAA;AAJA,KAAA;AAMA,GAVA;AAWA,EAAA,OAXA,qBAWA;AAAA;;AACA,QAAA,CAAA,oBAAA,CAAA,eAAA,EAAA,EAAA;AACA,WAAA,OAAA,CAAA,IAAA,CAAA;AAAA,QAAA,IAAA,EAAA;AAAA,OAAA;AACA;AACA;;AACA,SAAA,WAAA,GAAA,oBAAA,CAAA,cAAA,EAAA;;AACA,QAAA,oBAAA,CAAA,sBAAA,EAAA,EAAA;AACA,MAAA,UAAA,CAAA,GAAA,CAAA,MAAA,EACA,IADA,CACA,UAAA,GAAA;AAAA,eAAA,KAAA,CAAA,KAAA,GAAA,GAAA,CAAA,IAAA,CAAA,KAAA;AAAA,OADA,EAEA,KAFA,CAEA,UAAA,GAAA;AAAA,eAAA,OAAA,CAAA,GAAA,CAAA,GAAA,CAAA;AAAA,OAFA;AAGA,KAJA,MAIA;AACA,WAAA,KAAA,GAAA,CAAA,KAAA,WAAA,CAAA;AACA;AACA,GAxBA;AAyBA,EAAA,OAAA,EAAA;AACA,IAAA,iBAAA,EAAA,2BAAA,KAAA,EAAA,IAAA,EAAA;AACA,MAAA,OAAA,CAAA,GAAA,CAAA,KAAA;AACA,MAAA,OAAA,CAAA,GAAA,CAAA,IAAA,CAAA,UAAA;AACA,MAAA,UAAA,CAAA,GAAA,gBAAA,IAAA,CAAA,SAAA,GAAA;AAAA,QAAA,UAAA,EAAA,KAAA,CAAA,MAAA,CAAA,KAAA,IAAA;AAAA,OAAA,EACA,IADA,CACA,UAAA,GAAA,EAAA;AACA,QAAA,OAAA,CAAA,GAAA,CAAA,GAAA;AACA,QAAA,IAAA,CAAA,UAAA,GAAA,KAAA,CAAA,MAAA,CAAA,KAAA,IAAA,MAAA;AACA,OAJA,EAKA,KALA,CAKA,UAAA,GAAA;AAAA,eAAA,OAAA,CAAA,GAAA,CAAA,GAAA,CAAA;AAAA,OALA;AAMA,KAVA;AAWA,IAAA,gBAAA,EAAA,0BAAA,MAAA,EAAA,IAAA,EAAA;AACA,WAAA,iBAAA,CAAA,IAAA,CAAA,SAAA,IAAA,MAAA,CAAA,MAAA,CAAA,KAAA;AACA,KAbA;AAcA,IAAA,gBAAA,EAAA,0BAAA,IAAA,EAAA;AACA,WAAA,iBAAA,CAAA,IAAA,CAAA,SAAA,IAAA,IAAA,CAAA,KAAA;AACA,WAAA,YAAA;AACA,KAjBA;AAkBA,IAAA,OAAA,EAAA,iBAAA,KAAA,EAAA,IAAA,EAAA;AAAA;;AACA,UAAA,CAAA,oBAAA,CAAA,sBAAA,EAAA,EAAA;AACA,QAAA,KAAA,CAAA,oCAAA,CAAA;AACA;AACA;;AAEA,MAAA,UAAA,CAAA,MAAA,gBAAA,IAAA,CAAA,SAAA,GACA,IADA,CACA,UAAA,GAAA,EAAA;AACA,QAAA,MAAA,CAAA,KAAA,GAAA,MAAA,CAAA,KAAA,CAAA,MAAA,CAAA,UAAA,CAAA;AAAA,iBAAA,CAAA,CAAA,SAAA,KAAA,IAAA,CAAA,SAAA;AAAA,SAAA,CAAA;AACA,QAAA,OAAA,CAAA,GAAA,CAAA,GAAA;AACA,OAJA,EAKA,KALA,CAKA,UAAA,GAAA;AAAA,eAAA,OAAA,CAAA,GAAA,CAAA,GAAA,CAAA;AAAA,OALA;AAMA,KA9BA;AA+BA,IAAA,cAAA,EAAA,wBAAA,IAAA,EAAA;AACA,aAAA,MAAA,CAAA,IAAA,CAAA,KAAA,iBAAA,EAAA,IAAA,CAAA,UAAA,SAAA;AAAA,eAAA,SAAA,KAAA,IAAA,CAAA,SAAA;AAAA,OAAA,CAAA;AACA,KAjCA;AAkCA,IAAA,eAAA,EAAA,yBAAA,IAAA,EAAA;AAAA;;AACA,MAAA,UAAA,CAAA,GAAA,uBAAA,IAAA,CAAA,SAAA,GAAA;AAAA,QAAA,SAAA,EAAA,KAAA,iBAAA,CAAA,IAAA,CAAA,SAAA;AAAA,OAAA,EACA,IADA,CACA,UAAA,QAAA,EAAA;AACA,QAAA,IAAA,CAAA,KAAA,GAAA,MAAA,CAAA,iBAAA,CAAA,IAAA,CAAA,SAAA,CAAA;AACA,eAAA,MAAA,CAAA,iBAAA,CAAA,IAAA,CAAA,SAAA,CAAA;;AACA,QAAA,MAAA,CAAA,YAAA;AACA,OALA,EAKA,KALA,CAKA,UAAA,KAAA;AAAA,eAAA,OAAA,CAAA,KAAA,CAAA,KAAA,CAAA;AAAA,OALA;AAMA;AAzCA;AAzBA,CAAA","sourcesContent":["<template>\n  <div class=\"Users\">\n    <h1 v-if=\"currentUser.super_user\">Users</h1>\n    <h1 v-else>{{currentUser.name}}</h1>\n    <div class=\"container\">\n      <div class=\"col-md-12\">\n        <router-link to=\"register\" tag=\"a\" class=\"btn btn-primary\" v-if=\"currentUser.super_user\">Add user</router-link>\n        <router-link id=\"sendemail\" to=\"sendmail\" tag=\"a\" class=\"btn btn-primary\" v-if=\"currentUser.super_user\">\n          Send email</router-link>\n        <router-link id=\"changepw\" to=\"changepw\" tag=\"a\" class=\"btn btn-primary\">Change password</router-link>\n      </div>\n      <!-- SUPER USER -->\n      <table class=\"table\">\n        <tbody>\n          <th>Email</th>\n          <th>Username</th>\n          <th>Superuser</th>\n          <th v-if=\"currentUser.super_user\">Delete</th>\n        </tbody>\n        <tbody>\n          <tr v-for=\"user in users\" v-bind:key=\"user.public_id\">\n            <td>\n              <div v-if=\"!isEditingEmail(user)\">\n                {{ user.email }} \n                <a class=\"btn btn-primary btn-small\" v-on:click=\"onEditEmailClick(user)\">Change email</a>\n              </div>\n              <div v-else>\n                <input v-on:change=\"onNewEmailChange($event, user)\" placeholder=\"New email\" :value=\"editingUsersEmail[user.public_id]\" />\n                <a class=\"btn btn-primary btn-small\" v-on:click=\"updateUserEmail(user)\">Update</a>\n              </div>\n            </td>\n            <td>{{ user.name }}</td>\n            <td v-if=\"currentUser.super_user\">\n              <select @change=\"onSuperUserChange($event, user)\">\n                <option value=\"true\" :selected=\"user.super_user == true\">Yes</option>\n                <option value=\"false\" :selected=\"user.super_user == false\">No</option>\n              </select>\n            </td>\n            <td v-else>{{ user.super_user }}</td>\n            <td v-if=\"currentUser.super_user\">\n              <button type=\"button\" class=\"btn btn-danger\" @click=\"delUser($event, user)\">X</button>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</template>\n\n<script type=\"text/javascript\">\nimport RestClient from '../utils/rest-client';\nimport UserAuthentification from '../utils/user-authentification';\n\nexport default {\n  name: \"Users\",\n  props: [],\n  data: function() {\n    return {\n      users: [],\n      newEmail: '',\n      currentUser: null,\n      editingUsersEmail: {}\n    };\n  },\n  created() {\n    if(!UserAuthentification.isAuthenticated()){\n      this.$router.push({ path: '/login' });\n      return\n    }\n    this.currentUser = UserAuthentification.getCurrentUser();\n    if(UserAuthentification.isCurrentUserSuperUser()){\n       RestClient.get(\"user\")\n        .then(res => this.users = res.data.users)\n        .catch(err => console.log(err));\n    } else {\n      this.users = [this.currentUser];\n    }\n  },\n  methods: {\n    onSuperUserChange: function(event, user){\n      console.log(event);\n      console.log(user.super_user);\n      RestClient.put(`user/${user.public_id}`, { super_user: event.target.value == \"true\" })\n        .then(res => {\n          console.log(res);\n          user.super_user = event.target.value == \"true\";\n        })\n        .catch(err => console.log(err));\n    },\n    onNewEmailChange: function($event, user) {\n      this.editingUsersEmail[user.public_id] = $event.target.value;\n    },\n    onEditEmailClick: function(user){\n      this.editingUsersEmail[user.public_id] = user.email;\n      this.$forceUpdate();\n    },\n    delUser: function(event, user){\n      if (!UserAuthentification.isCurrentUserSuperUser()) {\n        alert('Vous n\\'êtes pas super utilisateur');\n        return;\n      }\n\n      RestClient.delete(`user/${user.public_id}`)\n        .then(res => {\n          this.users = this.users.filter((u) => u.public_id !== user.public_id);\n          console.log(res)\n        })\n        .catch(err => console.log(err));\n    },\n    isEditingEmail: function(user) {\n      return Object.keys(this.editingUsersEmail).some((public_id) => public_id === user.public_id);\n    },\n    updateUserEmail: function(user) {\n      RestClient.put(`/user/email/${user.public_id}`, { new_email: this.editingUsersEmail[user.public_id] })\n        .then((response) => {\n          user.email = this.editingUsersEmail[user.public_id];\n          delete this.editingUsersEmail[user.public_id];\n          this.$forceUpdate();\n        }).catch((error) => console.error(error));\n    }\n  },\n};\n</script>\n\n<style scoped>\n  .container {\n    text-align: left;\n  }\n\n  #sendemail{\n    margin-left: 5px;\n  }\n  #changepw{\n    margin-left: 5px;\n  }\n</style>"],"sourceRoot":"src/views"}]}