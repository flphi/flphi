{"remainingRequest":"C:\\Users\\Florian\\Desktop\\projet\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Florian\\Desktop\\projet\\src\\views\\Users.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Florian\\Desktop\\projet\\src\\views\\Users.vue","mtime":1587691631772},{"path":"C:\\Users\\Florian\\Desktop\\projet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Florian\\Desktop\\projet\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\Florian\\Desktop\\projet\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Florian\\Desktop\\projet\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBSZXN0Q2xpZW50IGZyb20gJy4uL3V0aWxzL3Jlc3QtY2xpZW50JzsKaW1wb3J0IFVzZXJBdXRoZW50aWZpY2F0aW9uIGZyb20gJy4uL3V0aWxzL3VzZXItYXV0aGVudGlmaWNhdGlvbic7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIlVzZXJzIiwKICBwcm9wczogW10sCiAgZGF0YTogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gewogICAgICB1c2VyczogW10sCiAgICAgIG5ld0VtYWlsOiAnJywKICAgICAgY3VycmVudFVzZXI6IG51bGwsCiAgICAgIGVkaXRpbmdVc2Vyc0VtYWlsOiB7fQogICAgfTsKICB9LAogIGNyZWF0ZWQoKSB7CiAgICBpZighVXNlckF1dGhlbnRpZmljYXRpb24uaXNBdXRoZW50aWNhdGVkKCkpewogICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7IHBhdGg6ICcvbG9naW4nIH0pOwogICAgICByZXR1cm4KICAgIH0KICAgIHRoaXMuY3VycmVudFVzZXIgPSBVc2VyQXV0aGVudGlmaWNhdGlvbi5nZXRDdXJyZW50VXNlcigpOwogICAgaWYoVXNlckF1dGhlbnRpZmljYXRpb24uaXNDdXJyZW50VXNlclN1cGVyVXNlcigpKXsKICAgICAgIFJlc3RDbGllbnQuZ2V0KCJ1c2VyIikKICAgICAgICAudGhlbihyZXMgPT4gdGhpcy51c2VycyA9IHJlcy5kYXRhLnVzZXJzKQogICAgICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLnVzZXJzID0gW3RoaXMuY3VycmVudFVzZXJdOwogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgb25TdXBlclVzZXJDaGFuZ2U6IGZ1bmN0aW9uKGV2ZW50LCB1c2VyKXsKICAgICAgY29uc29sZS5sb2coZXZlbnQpOwogICAgICBjb25zb2xlLmxvZyh1c2VyLnN1cGVyX3VzZXIpOwogICAgICBSZXN0Q2xpZW50LnB1dChgdXNlci8ke3VzZXIucHVibGljX2lkfWAsIHsgc3VwZXJfdXNlcjogZXZlbnQudGFyZ2V0LnZhbHVlID09ICJ0cnVlIiB9KQogICAgICAgIC50aGVuKHJlcyA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpOwogICAgICAgICAgdXNlci5zdXBlcl91c2VyID0gZXZlbnQudGFyZ2V0LnZhbHVlID09ICJ0cnVlIjsKICAgICAgICB9KQogICAgICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSk7CiAgICB9LAogICAgb25OZXdFbWFpbENoYW5nZTogZnVuY3Rpb24oJGV2ZW50LCB1c2VyKSB7CiAgICAgIHRoaXMuZWRpdGluZ1VzZXJzRW1haWxbdXNlci5wdWJsaWNfaWRdID0gJGV2ZW50LnRhcmdldC52YWx1ZTsKICAgIH0sCiAgICBvbkVkaXRFbWFpbENsaWNrOiBmdW5jdGlvbih1c2VyKXsKICAgICAgdGhpcy5lZGl0aW5nVXNlcnNFbWFpbFt1c2VyLnB1YmxpY19pZF0gPSB1c2VyLmVtYWlsOwogICAgICB0aGlzLiRmb3JjZVVwZGF0ZSgpOwogICAgfSwKICAgIGRlbFVzZXI6IGZ1bmN0aW9uKGV2ZW50LCB1c2VyKXsKICAgICAgaWYgKCFVc2VyQXV0aGVudGlmaWNhdGlvbi5pc0N1cnJlbnRVc2VyU3VwZXJVc2VyKCkpIHsKICAgICAgICBhbGVydCgnVm91cyBuXCfDqnRlcyBwYXMgc3VwZXIgdXRpbGlzYXRldXInKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIFJlc3RDbGllbnQuZGVsZXRlKGB1c2VyLyR7dXNlci5wdWJsaWNfaWR9YCkKICAgICAgICAudGhlbihyZXMgPT4gewogICAgICAgICAgdGhpcy51c2VycyA9IHRoaXMudXNlcnMuZmlsdGVyKCh1KSA9PiB1LnB1YmxpY19pZCAhPT0gdXNlci5wdWJsaWNfaWQpOwogICAgICAgICAgY29uc29sZS5sb2cocmVzKQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZyhlcnIpKTsKICAgIH0sCiAgICBpc0VkaXRpbmdFbWFpbDogZnVuY3Rpb24odXNlcikgewogICAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcy5lZGl0aW5nVXNlcnNFbWFpbCkuc29tZSgocHVibGljX2lkKSA9PiBwdWJsaWNfaWQgPT09IHVzZXIucHVibGljX2lkKTsKICAgIH0sCiAgICB1cGRhdGVVc2VyRW1haWw6IGZ1bmN0aW9uKHVzZXIpIHsKICAgICAgUmVzdENsaWVudC5wdXQoYC91c2VyL2VtYWlsLyR7dXNlci5wdWJsaWNfaWR9YCwgeyBuZXdfZW1haWw6IHRoaXMuZWRpdGluZ1VzZXJzRW1haWxbdXNlci5wdWJsaWNfaWRdIH0pCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICB1c2VyLmVtYWlsID0gdGhpcy5lZGl0aW5nVXNlcnNFbWFpbFt1c2VyLnB1YmxpY19pZF07CiAgICAgICAgICBkZWxldGUgdGhpcy5lZGl0aW5nVXNlcnNFbWFpbFt1c2VyLnB1YmxpY19pZF07CiAgICAgICAgICB0aGlzLiRmb3JjZVVwZGF0ZSgpOwogICAgICAgIH0pLmNhdGNoKChlcnJvcikgPT4gY29uc29sZS5lcnJvcihlcnJvcikpOwogICAgfQogIH0sCn07Cg=="},{"version":3,"sources":["Users.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Users.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"Users\">\n    <h1 v-if=\"currentUser.super_user\">Users</h1>\n    <h1 v-else>{{currentUser.name}}</h1>\n    <div class=\"container\">\n      <div class=\"col-md-12\">\n        <router-link to=\"register\" tag=\"a\" class=\"btn btn-primary\" v-if=\"currentUser.super_user\">Add user</router-link>\n        <router-link id=\"sendemail\" to=\"sendmail\" tag=\"a\" class=\"btn btn-primary\" v-if=\"currentUser.super_user\">\n          Send email</router-link>\n        <router-link id=\"changepw\" to=\"changepw\" tag=\"a\" class=\"btn btn-primary\">Change password</router-link>\n      </div>\n      <!-- SUPER USER -->\n      <table class=\"table\">\n        <tbody>\n          <th>Email</th>\n          <th>Username</th>\n          <th>Superuser</th>\n          <th v-if=\"currentUser.super_user\">Delete</th>\n        </tbody>\n        <tbody>\n          <tr v-for=\"user in users\" v-bind:key=\"user.public_id\">\n            <td>\n              <div v-if=\"!isEditingEmail(user)\">\n                {{ user.email }} \n                <a class=\"btn btn-primary btn-small\" v-on:click=\"onEditEmailClick(user)\">Change email</a>\n              </div>\n              <div v-else>\n                <input v-on:change=\"onNewEmailChange($event, user)\" placeholder=\"New email\" :value=\"editingUsersEmail[user.public_id]\" />\n                <a class=\"btn btn-primary btn-small\" v-on:click=\"updateUserEmail(user)\">Update</a>\n              </div>\n            </td>\n            <td>{{ user.name }}</td>\n            <td v-if=\"currentUser.super_user\">\n              <select @change=\"onSuperUserChange($event, user)\">\n                <option value=\"true\" :selected=\"user.super_user == true\">Yes</option>\n                <option value=\"false\" :selected=\"user.super_user == false\">No</option>\n              </select>\n            </td>\n            <td v-else>{{ user.super_user }}</td>\n            <td v-if=\"currentUser.super_user\">\n              <button type=\"button\" class=\"btn btn-danger\" @click=\"delUser($event, user)\">X</button>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</template>\n\n<script type=\"text/javascript\">\nimport RestClient from '../utils/rest-client';\nimport UserAuthentification from '../utils/user-authentification';\n\nexport default {\n  name: \"Users\",\n  props: [],\n  data: function() {\n    return {\n      users: [],\n      newEmail: '',\n      currentUser: null,\n      editingUsersEmail: {}\n    };\n  },\n  created() {\n    if(!UserAuthentification.isAuthenticated()){\n      this.$router.push({ path: '/login' });\n      return\n    }\n    this.currentUser = UserAuthentification.getCurrentUser();\n    if(UserAuthentification.isCurrentUserSuperUser()){\n       RestClient.get(\"user\")\n        .then(res => this.users = res.data.users)\n        .catch(err => console.log(err));\n    } else {\n      this.users = [this.currentUser];\n    }\n  },\n  methods: {\n    onSuperUserChange: function(event, user){\n      console.log(event);\n      console.log(user.super_user);\n      RestClient.put(`user/${user.public_id}`, { super_user: event.target.value == \"true\" })\n        .then(res => {\n          console.log(res);\n          user.super_user = event.target.value == \"true\";\n        })\n        .catch(err => console.log(err));\n    },\n    onNewEmailChange: function($event, user) {\n      this.editingUsersEmail[user.public_id] = $event.target.value;\n    },\n    onEditEmailClick: function(user){\n      this.editingUsersEmail[user.public_id] = user.email;\n      this.$forceUpdate();\n    },\n    delUser: function(event, user){\n      if (!UserAuthentification.isCurrentUserSuperUser()) {\n        alert('Vous n\\'Ãªtes pas super utilisateur');\n        return;\n      }\n\n      RestClient.delete(`user/${user.public_id}`)\n        .then(res => {\n          this.users = this.users.filter((u) => u.public_id !== user.public_id);\n          console.log(res)\n        })\n        .catch(err => console.log(err));\n    },\n    isEditingEmail: function(user) {\n      return Object.keys(this.editingUsersEmail).some((public_id) => public_id === user.public_id);\n    },\n    updateUserEmail: function(user) {\n      RestClient.put(`/user/email/${user.public_id}`, { new_email: this.editingUsersEmail[user.public_id] })\n        .then((response) => {\n          user.email = this.editingUsersEmail[user.public_id];\n          delete this.editingUsersEmail[user.public_id];\n          this.$forceUpdate();\n        }).catch((error) => console.error(error));\n    }\n  },\n};\n</script>\n\n<style scoped>\n  .container {\n    text-align: left;\n  }\n\n  #sendemail{\n    margin-left: 5px;\n  }\n  #changepw{\n    margin-left: 5px;\n  }\n</style>"]}]}